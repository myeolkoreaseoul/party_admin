# 📊 뭘 좀 아는 사람들 - 스프레드시트 스키마

> **설계 원칙**: 정규화된 저장 + 통합 뷰 조회
> **SPREADSHEET_ID**: `1dZGU-x2xNgFSGyv_esL95AZ5A20EtWbwgHCpLjFYtiU`

---

## 🗂️ 시트 구조 개요

| 시트명 | 역할 | PK | 특징 |
|--------|------|-----|------|
| 고객마스터 | 고객 기본정보 | 연락처 | 1인 1행, 정보 수정은 여기만 |
| 초대장신청 | invite 신청 내역 | 신청ID | 연락처(FK)로 고객마스터 연결 |
| 프립예약 | 프립 결제 내역 | 예약번호 | 1예약 1행, 다중 예약 가능 |
| 사전조사 | survey.html 원본 | 제출ID | 제출 시 고객마스터에 upsert |
| 통합고객관리 | 운영용 뷰 (자동생성) | - | 위 4개 JOIN, 1예약=1행 |

---

## 📋 시트별 상세 스키마

### 1. 고객마스터 (1인 1행)

> **역할**: 고객의 기본 정보를 저장하는 마스터 테이블
> **생성 시점**: 사전조사 제출 시 upsert / 프립예약 시 없으면 생성
> **수정 원칙**: 고객 정보 수정은 이 시트에서만!

| 컬럼명 | 타입 | 필수 | 설명 | 예시 |
|--------|------|------|------|------|
| 연락처 | 텍스트 | ✅ PK | 전화번호 (정규화: 010-XXXX-XXXX) | 010-9473-9509 |
| 이름 | 텍스트 | ✅ | 실명 | 조세목 |
| 성별 | 텍스트 | ✅ | 남자/여자 | 남자 |
| 출생연도 | 숫자 | ✅ | YYYY | 1995 |
| 신장 | 숫자 | ✅ | cm | 174 |
| 직업분류 | 텍스트 | ✅ | 대분류 (23종) | 대기업 |
| 직업상세 | 텍스트 | | 상세 직업명 | 삼성전자 |
| 직업인증서류 | 텍스트 | | Google Drive URL | https://drive.google.com/... |
| 유입경로 | 텍스트 | | invitation/organic | invitation |
| 마케팅동의 | 텍스트 | | Y/N | Y |
| 최초등록일 | 날짜 | ✅ | 자동생성 | 2026-01-02 |
| 최종수정일 | 날짜 | ✅ | 자동갱신 | 2026-01-02 |
| 메모 | 텍스트 | | 관리자 메모 | VIP 고객 |

**직업분류 옵션 (23종)**:
```
대기업, 회사원, 외국계, 전문직(문과계열), 전문직(이과계열), 
연예인/인플루언서, 필라테스/요가 강사, 공기업, 공무원, 예체능, 
금융권, 교육직, 연구직, IT/개발자, 디자이너, 마케팅/광고/미디어, 
간호사, 프리랜서, 자영업/사업가, 대학원생, 의료직, 승무원, 사무직, 기타
```

---

### 2. 초대장신청 (1신청 1행)

> **역할**: invite 사이트(verification.html)에서 신청한 내역
> **생성 시점**: verification.html 제출 시
> **연결**: 연락처 → 고객마스터

| 컬럼명 | 타입 | 필수 | 설명 | 예시 |
|--------|------|------|------|------|
| 신청ID | 텍스트 | ✅ PK | 자동생성 UUID | INV-20260102-001 |
| 연락처 | 텍스트 | ✅ FK | 고객마스터 연결 | 010-9473-9509 |
| 선택자격 | 텍스트 | ✅ | 쉼표 구분 | 직업,학력 |
| 선택그룹 | 텍스트 | ✅ | 쉼표 구분 | career,influence |
| 와인보너스 | 텍스트 | ✅ | Y/N (2그룹 이상 시 Y) | Y |
| 인증방법 | 텍스트 | ✅ | upload/onsite/coupon/host_referral | upload |
| SNS링크 | 텍스트 | | SNS 선택 시 | instagram.com/svvy_s |
| 초대장파일링크 | 텍스트 | | 업로드한 증빙자료 URL | https://drive.google.com/... |
| 쿠폰코드 | 텍스트 | | 추천 코드 | WELCOME26 |
| 호스트명 | 텍스트 | | 추천 호스트 | 까비 |
| 추천경위 | 텍스트 | | 어떻게 추천받았는지 | 지인 |
| 배포처 | 텍스트 | | URL source 파라미터 | insta/gopas/direct |
| 승인상태 | 텍스트 | ✅ | 상태값 | 승인완료 |
| 신청일시 | 날짜시간 | ✅ | 자동생성 | 2026-01-02 14:30:00 |

**승인상태 옵션**:
| 상태 | 조건 |
|------|------|
| 인증대기 | 기본값 |
| 쿠폰승인 | 쿠폰 코드로 즉시 승인 |
| 승인완료 | 호스트 추천 또는 심사 통과 |
| 서류제출완료 | 파일 업로드 완료 |
| 현장인증예정 | 현장에서 인증하기로 선택 |

**선택자격 옵션 (8종)**:
| 자격 | 그룹 | 조건 |
|------|------|------|
| 직업 | career | 전문직/대기업/공기업/공무원(7급↑) |
| 학력 | career | SKY/해외대(QS 200위) |
| 연봉자산 | career | 연봉8천/매출2억/자산5억 |
| 외모 | appearance | 승무원/아나운서/미인대회 등 |
| 운동 | appearance | 마라톤완주/체지방 남15%여23%↓ |
| SNS | influence | 팔로워 5천명↑ |
| 득표3표 | influence | 기존 파티 동시득표 3표↑ |
| 추천 | influence | 호스트 추천코드 |

**와인보너스 규칙**:
- 2개 **그룹** 이상 선택 시 Y
- 예: 직업(career) + 외모(appearance) = 2그룹 → Y
- 예: 직업(career) + 학력(career) = 1그룹 → N

---

### 3. 프립예약 (1예약 1행)

> **역할**: 프립에서 결제/예약된 내역 (Tasker 연동)
> **생성 시점**: Tasker에서 프립 예약 알림 수신 시
> **연결**: 연락처 → 고객마스터
> **다중 예약**: 한 고객이 여러 날짜/파티 예약 가능 → 여러 행

| 컬럼명 | 타입 | 필수 | 설명 | 예시 |
|--------|------|------|------|------|
| 예약번호 | 텍스트 | ✅ PK | 프립 예약번호 | 12345678 |
| 연락처 | 텍스트 | ✅ FK | 고객마스터 연결 | 010-9473-9509 |
| 크루명 | 텍스트 | ✅ | 예약자 이름 | 조세목 |
| 진행일시 | 텍스트 | ✅ | 파티 날짜/시간 | 2026년 1월 11일 오후 12:00 |
| 프로그램 | 텍스트 | ✅ | 옵션명 | [1, 2부 커피] 인비테이션 패스 소지자 |
| 예약상태 | 텍스트 | ✅ | 예약완료/취소 | 예약완료 |
| 등록일시 | 날짜시간 | ✅ | 예약 시점 | 2026-01-02 10:30:00 |

**프로그램 옵션**:
| 옵션명 | 가격 | 시간 |
|--------|------|------|
| [1, 2부 커피] 인비테이션 패스 소지자 | 5,000원 | 12:00 또는 15:00 |
| [3부 와인] 인비테이션 패스 소지자 | 10,000원 | 19:00 |
| [1, 2부 커피] 일반 | 15,000원 | 12:00 또는 15:00 |
| [3부 와인] 일반 | 25,000원 | 19:00 |

---

### 4. 사전조사 (1제출 1행)

> **역할**: survey.html에서 제출된 원본 데이터 보관
> **생성 시점**: survey.html 제출 시
> **연동**: 제출 시 → 고객마스터에 upsert (없으면 생성, 있으면 업데이트)

| 컬럼명 | 타입 | 필수 | 설명 | 예시 |
|--------|------|------|------|------|
| 제출ID | 텍스트 | ✅ PK | 자동생성 | SRV-20260102-001 |
| 연락처 | 텍스트 | ✅ | 전화번호 | 010-9473-9509 |
| 이름 | 텍스트 | ✅ | 실명 | 조세목 |
| 성별 | 텍스트 | ✅ | 남자/여자 | 남자 |
| 출생연도 | 숫자 | ✅ | YYYY | 1995 |
| 신장 | 숫자 | ✅ | cm | 174 |
| 직업분류 | 텍스트 | ✅ | 대분류 | 대기업 |
| 직업상세 | 텍스트 | | 상세 | 삼성전자 |
| 직업인증서류 | 텍스트 | ✅ | Drive URL | https://drive.google.com/... |
| 약관동의 | 텍스트 | ✅ | Y | Y |
| 마케팅동의 | 텍스트 | | Y/N | Y |
| 제출일시 | 날짜시간 | ✅ | 자동생성 | 2026-01-02 15:00:00 |

---

### 5. 통합고객관리 (자동생성 뷰)

> **역할**: 운영용 통합 뷰 - 한눈에 모든 정보 확인
> **생성 방식**: GAS 함수로 위 4개 시트 JOIN하여 자동 생성
> **갱신 주기**: 수동 새로고침 또는 트리거 설정
> **특징**: 1예약 = 1행 (다중 예약 시 같은 고객이 여러 행)

| 컬럼명 | 출처 | 설명 |
|--------|------|------|
| ID | 자동생성 | 행 번호 |
| 현재단계 | 계산 | 1.초대장신청 / 2.프립예약 / 3.사전조사완료 |
| 유입경로 | 고객마스터 | invitation / organic |
| 크루명 | 고객마스터 | 이름 |
| 연락처 | 고객마스터 | 전화번호 (PK) |
| 성별 | 고객마스터 | 남자/여자 |
| 출생연도 | 고객마스터 | YYYY |
| 신장 | 고객마스터 | cm |
| 직업분류 | 고객마스터 | 대분류 |
| 직업상세 | 고객마스터 | 상세 |
| 선택자격 | 초대장신청 | 쉼표 구분 |
| 선택그룹 | 초대장신청 | 쉼표 구분 |
| 와인보너스 | 초대장신청 | Y/N |
| 인증방법 | 초대장신청 | upload/onsite/coupon/host_referral |
| SNS링크 | 초대장신청 | URL |
| 초대장파일링크 | 초대장신청 | Drive URL |
| 쿠폰코드 | 초대장신청 | 코드 |
| 호스트명 | 초대장신청 | 추천인 |
| 추천경위 | 초대장신청 | 경위 |
| 배포처 | 초대장신청 | source |
| 직업인증서류 | 고객마스터 | Drive URL |
| 진행일시 | 프립예약 | 파티 날짜/시간 |
| 프로그램 | 프립예약 | 옵션명 |
| 프립예약번호 | 프립예약 | 예약번호 |
| 예약상태 | 프립예약 | 예약완료/취소 |
| 사전조사완료 | 계산 | Y/N (사전조사 시트에 있으면 Y) |
| 승인상태 | 초대장신청 | 상태 |
| 참석여부 | 별도관리 | Y/N/- |
| 환급여부 | 별도관리 | Y/N/- |
| 메모 | 고객마스터 | 관리자 메모 |

**현재단계 계산 로직**:
```
IF 사전조사 있음 → "3.사전조사완료"
ELSE IF 프립예약 있음 → "2.프립예약"
ELSE IF 초대장신청 있음 → "1.초대장신청"
ELSE → "0.미등록"
```

---

## 🔄 데이터 흐름

### A. Invite 고객 (초대장 신청자)

```
1. index.html에서 자격 선택
   ↓
2. verification.html에서 인증방법 선택 + 연락처 입력
   ↓
3. [초대장신청] 시트에 저장
   - 승인상태: 쿠폰승인/서류제출완료/현장인증예정
   ↓
4. 프립에서 예약 (인비테이션 패스 옵션)
   ↓
5. Tasker → [프립예약] 시트에 저장
   - 고객마스터에 없으면 생성 (유입경로: invitation)
   ↓
6. survey.html 제출
   ↓
7. [사전조사] 시트에 저장 + [고객마스터] upsert
   ↓
8. ✅ 참여 확정 (현재단계: 3.사전조사완료)
```

### B. 일반 고객 (Organic)

```
1. 프립에서 직접 예약 (일반 옵션)
   ↓
2. Tasker → [프립예약] 시트에 저장
   - 고객마스터에 없으면 생성 (유입경로: organic)
   ↓
3. survey.html 제출
   ↓
4. [사전조사] 시트에 저장 + [고객마스터] upsert
   ↓
5. ✅ 참여 확정 (현재단계: 3.사전조사완료)
```

---

## 📝 다중 예약 예시

**조세목님이 3개 파티 예약한 경우**

### 고객마스터 (1행)
| 연락처 | 이름 | 성별 | 출생연도 | 신장 | 직업분류 |
|--------|------|------|---------|------|---------|
| 010-9473-9509 | 조세목 | 남자 | 1995 | 174 | 대기업 |

### 프립예약 (3행)
| 예약번호 | 연락처 | 진행일시 | 프로그램 |
|---------|--------|---------|---------|
| 12345 | 010-9473-9509 | 1/11 12:00 | 1부 커피 |
| 12346 | 010-9473-9509 | 1/11 19:00 | 3부 와인 |
| 12347 | 010-9473-9509 | 1/18 19:00 | 3부 와인 |

### 통합고객관리 (3행)
| ID | 크루명 | 연락처 | 진행일시 | 프로그램 | 사전조사 |
|----|-------|--------|---------|---------|---------|
| 1 | 조세목 | 010-9473-9509 | 1/11 12:00 | 1부 커피 | Y |
| 2 | 조세목 | 010-9473-9509 | 1/11 19:00 | 3부 와인 | Y |
| 3 | 조세목 | 010-9473-9509 | 1/18 19:00 | 3부 와인 | Y |

→ 고객 정보 수정 시 **고객마스터 1행만 수정** → 통합뷰 갱신 시 3행 모두 반영

---

## 🚀 마이그레이션 가이드

### 기존 데이터 이관 순서

1. **기존 통합고객관리 시트 백업**
2. **고객마스터 시트 생성** (컬럼 헤더 추가)
3. **GAS에서 `migrateToNormalizedStructure()` 실행**
   - 기존 데이터에서 고객정보 추출 → 고객마스터
   - 기존 데이터에서 초대장정보 추출 → 초대장신청
   - 프립예약/사전조사는 기존 시트 유지
4. **통합뷰 생성 함수 실행**
5. **검증 후 기존 시트 보관용으로 이름 변경**

---

## 📅 최종 수정일

- 2026-01-02: 최초 작성
- 설계자: Claude (AI Assistant)
