<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë­˜ ì¢€ ì•„ëŠ” ì‚¬ëŒë“¤ - ëŒ€í™” ì£¼ì œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --accent: #a8e063;
            --accent-hover: #96cc54;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .btn-accent {
            background-color: var(--accent);
            transition: background-color 0.2s;
        }
        .btn-accent:hover {
            background-color: var(--accent-hover);
        }
        .btn-accent:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="bg-black min-h-screen">
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loading" class="min-h-screen flex items-center justify-center">
        <div class="text-[#a8e063] text-xl">ë¡œë”© ì¤‘...</div>
    </div>

    <!-- í™ˆ í™”ë©´ -->
    <div id="home" class="min-h-screen flex-col items-center justify-center px-6 py-10 hidden relative">
        <!-- ì¢Œì¸¡ ìƒë‹¨ ë¸Œëœë“œ -->
        <div class="absolute top-4 left-4">
            <span class="text-[#a8e063] text-sm font-medium">ë­˜ ì¢€ ì•„ëŠ” ì‚¬ëŒë“¤</span>
        </div>
        <div class="w-full max-w-sm flex flex-col items-center">
            <!-- ë¡œê³  -->
            <h1 class="text-white text-2xl font-bold mb-2">ë­˜ ì¢€ ì•„ëŠ” ì‚¬ëŒë“¤</h1>
            <p class="text-gray-400 text-sm mb-10">1:1 ë¡œí…Œì´ì…˜ ì†Œê°œíŒ…</p>

            <!-- ëŒ€í™” ì‹œì‘í•˜ê¸° ë²„íŠ¼ -->
            <button onclick="startAutoMode()" class="w-full btn-accent text-black font-bold py-4 px-6 rounded-xl mb-2">
                â–¶ ëŒ€í™” ì‹œì‘í•˜ê¸°
            </button>
            <p class="text-gray-500 text-sm mb-10">ìë™ìœ¼ë¡œ ì£¼ì œê°€ ë°”ë€Œì–´ìš”</p>

            <!-- êµ¬ë¶„ì„  -->
            <div class="w-full flex items-center mb-6">
                <div class="flex-1 h-px bg-gray-700"></div>
                <span class="px-4 text-gray-500 text-sm">íŠ¹ì • ì£¼ì œë§Œ ì›í•˜ë©´</span>
                <div class="flex-1 h-px bg-gray-700"></div>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ë“¤ -->
            <div class="w-full grid grid-cols-2 gap-3">
                <button onclick="selectCategory('ì¼ìƒ')" class="bg-gray-800 text-white py-4 px-4 rounded-xl hover:bg-gray-700 transition-colors text-lg">
                    â˜• ì¼ìƒ
                </button>
                <button onclick="selectCategory('ì—°ì• ')" class="bg-gray-800 text-white py-4 px-4 rounded-xl hover:bg-gray-700 transition-colors text-lg">
                    ğŸ’• ì—°ì• 
                </button>
                <button onclick="selectCategory('ì‹¬ë¦¬')" class="bg-gray-800 text-white py-4 px-4 rounded-xl hover:bg-gray-700 transition-colors text-lg">
                    ğŸ§  ì‹¬ë¦¬
                </button>
                <button onclick="selectCategory('19ê¸ˆ')" class="bg-gray-800 text-white py-4 px-4 rounded-xl hover:bg-gray-700 transition-colors text-lg">
                    ğŸ”¥
                </button>
            </div>

            <!-- ì¸ìŠ¤íƒ€ ë§í¬ -->
            <a href="https://instagram.com/svvy.s" target="_blank" rel="noopener noreferrer"
               class="mt-12 text-gray-500 text-sm hover:text-[#a8e063] transition-colors">
                @svvy.s
            </a>
        </div>
    </div>

    <!-- ì§ˆë¬¸ í™”ë©´ -->
    <div id="question" class="min-h-screen flex-col hidden">
        <!-- ìƒë‹¨ í—¤ë” -->
        <div class="flex items-center justify-between px-4 py-4 border-b border-gray-800">
            <div class="flex items-center gap-4">
                <span class="text-[#a8e063] text-sm font-medium">ë­˜ ì¢€ ì•„ëŠ” ì‚¬ëŒë“¤</span>
                <div class="text-white text-lg">
                    <span id="categoryDisplay"></span>
                    <span id="autoLabel" class="ml-2 text-xs text-gray-500 hidden">ìë™</span>
                </div>
            </div>
            <button onclick="goHome()" class="text-gray-400 text-2xl hover:text-white transition-colors">
                âœ•
            </button>
        </div>

        <!-- ì§ˆë¬¸ ì˜ì—­ -->
        <div class="flex-1 flex items-center justify-center px-6" style="min-height: calc(100vh - 180px);">
            <p id="questionContent" class="text-white text-xl text-center leading-relaxed"></p>
        </div>

        <!-- ë‹¤ìŒ ì§ˆë¬¸ ë²„íŠ¼ -->
        <div class="px-6 pb-4">
            <button onclick="nextQuestion()" class="w-full btn-accent text-black font-bold py-4 rounded-xl">
                ë‹¤ìŒ ì§ˆë¬¸
            </button>
        </div>

        <!-- í•˜ë‹¨ ì¹´í…Œê³ ë¦¬ ì „í™˜ -->
        <div class="flex justify-center gap-6 pb-8 border-t border-gray-800 pt-4">
            <button onclick="switchCategory('ì¼ìƒ')" id="cat-ì¼ìƒ" class="text-2xl transition-opacity opacity-40 hover:opacity-70">â˜•</button>
            <button onclick="switchCategory('ì—°ì• ')" id="cat-ì—°ì• " class="text-2xl transition-opacity opacity-40 hover:opacity-70">ğŸ’•</button>
            <button onclick="switchCategory('ì‹¬ë¦¬')" id="cat-ì‹¬ë¦¬" class="text-2xl transition-opacity opacity-40 hover:opacity-70">ğŸ§ </button>
            <button onclick="switchCategory('19ê¸ˆ')" id="cat-19ê¸ˆ" class="text-2xl transition-opacity opacity-40 hover:opacity-70">ğŸ”¥</button>
        </div>
    </div>

    <script>
        // Supabase ì„¤ì •
        const SUPABASE_URL = 'https://bqpxdxsgxoapguknxwul.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxcHhkeHNneG9hcGd1a254d3VsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc1MjUyNDAsImV4cCI6MjA4MzEwMTI0MH0.v_r3wIIIe024k-H-9dyHH-LJj73kP9iU_eYgHZX7CGA';
        const API_BASE = `${SUPABASE_URL}/rest/v1`;

        // ì¹´í…Œê³ ë¦¬ ì •ë³´
        const CATEGORY_INFO = {
            'ì¼ìƒ': { emoji: 'â˜•', label: 'ì¼ìƒ' },
            'ì—°ì• ': { emoji: 'ğŸ’•', label: 'ì—°ì• ' },
            'ì‹¬ë¦¬': { emoji: 'ğŸ§ ', label: 'ì‹¬ë¦¬' },
            '19ê¸ˆ': { emoji: 'ğŸ”¥', label: '' }
        };

        const AUTO_SEQUENCE = ['ì¼ìƒ', 'ì—°ì• ', 'ì‹¬ë¦¬'];

        // ìƒíƒœ
        let questions = [];
        let usedIds = new Set();
        let currentCategory = null;
        let currentQuestion = null;
        let isAutoMode = false;
        let autoIndex = 0;

        // DOM ìš”ì†Œ
        const loadingEl = document.getElementById('loading');
        const homeEl = document.getElementById('home');
        const questionEl = document.getElementById('question');
        const categoryDisplayEl = document.getElementById('categoryDisplay');
        const autoLabelEl = document.getElementById('autoLabel');
        const questionContentEl = document.getElementById('questionContent');

        // ì§ˆë¬¸ ë°ì´í„° ë¡œë“œ
        async function fetchQuestions() {
            try {
                const response = await fetch(`${API_BASE}/questions?select=*`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });

                if (!response.ok) throw new Error('Failed to fetch');

                questions = await response.json();
                console.log(`ì§ˆë¬¸ ${questions.length}ê°œ ë¡œë“œë¨`);

                // ë¡œë”© ì™„ë£Œ â†’ í™ˆ í™”ë©´
                loadingEl.classList.add('hidden');
                homeEl.classList.remove('hidden');
                homeEl.classList.add('flex');
            } catch (error) {
                console.error('ì§ˆë¬¸ ë¡œë“œ ì˜¤ë¥˜:', error);
                loadingEl.innerHTML = '<div class="text-red-500 text-xl">ë¡œë”© ì‹¤íŒ¨</div>';
            }
        }

        // íŠ¹ì • ì¹´í…Œê³ ë¦¬ì—ì„œ ëœë¤ ì§ˆë¬¸
        function getRandomQuestion(category) {
            const available = questions.filter(q => q.category === category && !usedIds.has(q.id));

            if (available.length === 0) {
                // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ì§ˆë¬¸ ëª¨ë‘ ì†Œì§„ì‹œ ë¦¬ì…‹
                const allInCategory = questions.filter(q => q.category === category);
                if (allInCategory.length === 0) return null;

                // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ë§Œ ë¦¬ì…‹
                allInCategory.forEach(q => usedIds.delete(q.id));
                return allInCategory[Math.floor(Math.random() * allInCategory.length)];
            }

            return available[Math.floor(Math.random() * available.length)];
        }

        // í™”ë©´ ì „í™˜
        function showScreen(screen) {
            homeEl.classList.add('hidden');
            homeEl.classList.remove('flex');
            questionEl.classList.add('hidden');
            questionEl.classList.remove('flex');

            if (screen === 'home') {
                homeEl.classList.remove('hidden');
                homeEl.classList.add('flex');
            } else if (screen === 'question') {
                questionEl.classList.remove('hidden');
                questionEl.classList.add('flex');
            }
        }

        // ì§ˆë¬¸ í™”ë©´ ì—…ë°ì´íŠ¸
        function updateQuestionDisplay() {
            if (!currentCategory || !currentQuestion) return;

            const info = CATEGORY_INFO[currentCategory];
            categoryDisplayEl.textContent = `${info.emoji} ${info.label || '19ê¸ˆ'}`;
            questionContentEl.textContent = `"${currentQuestion.content}"`;

            // ìë™ ë¼ë²¨
            autoLabelEl.classList.toggle('hidden', !isAutoMode);

            // í•˜ë‹¨ ì¹´í…Œê³ ë¦¬ í•˜ì´ë¼ì´íŠ¸
            ['ì¼ìƒ', 'ì—°ì• ', 'ì‹¬ë¦¬', '19ê¸ˆ'].forEach(cat => {
                const btn = document.getElementById(`cat-${cat}`);
                if (btn) {
                    btn.classList.toggle('opacity-100', cat === currentCategory);
                    btn.classList.toggle('opacity-40', cat !== currentCategory);
                }
            });
        }

        // ìë™ ëª¨ë“œ ì‹œì‘
        function startAutoMode() {
            isAutoMode = true;
            autoIndex = 0;
            const category = AUTO_SEQUENCE[0];
            const question = getRandomQuestion(category);

            if (question) {
                currentCategory = category;
                currentQuestion = question;
                usedIds.add(question.id);
                updateQuestionDisplay();
                showScreen('question');
            }
        }

        // ì§ì ‘ ì„ íƒ ëª¨ë“œ
        function selectCategory(category) {
            isAutoMode = false;
            const question = getRandomQuestion(category);

            if (question) {
                currentCategory = category;
                currentQuestion = question;
                usedIds.add(question.id);
                updateQuestionDisplay();
                showScreen('question');
            }
        }

        // ì¹´í…Œê³ ë¦¬ ì „í™˜ (ì§ˆë¬¸ í™”ë©´ì—ì„œ)
        function switchCategory(category) {
            isAutoMode = false;
            const question = getRandomQuestion(category);

            if (question) {
                currentCategory = category;
                currentQuestion = question;
                usedIds.add(question.id);
                updateQuestionDisplay();
            }
        }

        // ë‹¤ìŒ ì§ˆë¬¸
        function nextQuestion() {
            let category;

            if (isAutoMode) {
                autoIndex = (autoIndex + 1) % AUTO_SEQUENCE.length;
                category = AUTO_SEQUENCE[autoIndex];
            } else {
                category = currentCategory;
            }

            const question = getRandomQuestion(category);

            if (question) {
                currentCategory = category;
                currentQuestion = question;
                usedIds.add(question.id);
                updateQuestionDisplay();
            }
        }

        // í™ˆìœ¼ë¡œ
        function goHome() {
            currentQuestion = null;
            currentCategory = null;
            showScreen('home');
        }

        // ì´ˆê¸°í™”
        fetchQuestions();
    </script>
</body>
</html>
